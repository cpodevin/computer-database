<?xml version = "1.0" encoding = "UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:mvc="http://www.springframework.org/schema/mvc"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
   http://www.springframework.org/schema/context
   http://www.springframework.org/schema/context/spring-context-3.0.xsd
   http://www.springframework.org/schema/mvc
   http://www.springframework.org/schema/mvc/spring-mvc.xsd">


	<context:component-scan
		base-package="com.excilys.cdb.controller" />
	<mvc:annotation-driven />
	<!-- bean definitions go here -->

	<bean id="myProperties"
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="locations">
			<list>
				<value>classpath:hikari.properties</value>
			</list>
		</property>
	</bean>

	<bean id="computerDAO" class="com.excilys.cdb.dao.ComputerDAO"
		scope="singleton" autowire="byName"></bean>
		
	<bean id="companyDAO" class="com.excilys.cdb.dao.CompanyDAO"
		scope="singleton" autowire="byName"></bean>
		
	<bean id="computerService" class="com.excilys.cdb.service.ComputerService" 
	 scope="singleton" autowire="byName"></bean>
		
	<bean id="companyService" class="com.excilys.cdb.service.CompanyService" 
	 scope="singleton" autowire="byName"></bean>
		
	<bean id="computerMapper" class="com.excilys.cdb.dto.ComputerMapper"
	 scope="singleton"></bean>
		
	<bean id="companyMapper" class="com.excilys.cdb.dto.CompanyMapper"
	 scope="singleton"></bean>
		
	<bean id="validator" class="com.excilys.cdb.dto.ComputerDTOValidator"
	 scope="singleton"></bean>
		
		
	<bean id="controller"
		class="com.excilys.cdb.controller.CLIController" scope="singleton"
		autowire="byName"></bean>
	
	
	<bean id="dataSource"
		class="org.springframework.jdbc.datasource.DriverManagerDataSource">
		<property name="driverClassName" value="${driverClassName}" />
		<property name="url" value="${jdbcUrl}" />
		<property name="username" value="${username}" />
		<property name="password" value="${password}" />
	</bean>

	<bean id="jdbcTemplate"
		class="org.springframework.jdbc.core.JdbcTemplate">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="sessionFactory"
		class="org.springframework.orm.hibernate5.LocalSessionFactoryBean">
		<property name="dataSource" ref="dataSource" />
		<property name="packagesToScan"
			value="com.excilys.cdb.model.*" />
		<property name="mappingLocations"
			value="classpath*:properties/*.hbm.xml" />
		<property name="hibernateProperties">
			<props>
				<prop key="hibernate.hbm2ddl.auto">
					update
				</prop> 
				<prop key="hibernate.allow_update_outside_transaction">
					true
				</prop>
				<prop key="hibernate.dialect">
					org.hibernate.dialect.MySQLDialect
				</prop>
			</props>
		</property>
	</bean>

	<bean id="queryFactory"
		class="com.querydsl.jpa.impl.JPAQueryFactory">
		<constructor-arg>
			<bean factory-bean="sessionFactory"
				factory-method="createEntityManager"></bean>
		</constructor-arg>
	</bean>


</beans>
